<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1057px" preserveAspectRatio="none" style="width:844px;height:1057px;background:#FFFFFF;" version="1.1" viewBox="0 0 844 1057" width="844px" zoomAndPan="magnify"><defs/><g><rect height="58.8906" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="259" x="289.75" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="203" x="317.75" y="27.9951">GitLab Kubernetes Agent</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="244" x="299.75" y="44.292">Runner CD Push Configuration</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="225" x="309.25" y="60.5889">&amp; GitOps Pull Configuration</text><rect fill="#90EE90" height="844.4375" style="stroke:#000000;stroke-width:0.5;" width="130" x="1" y="75.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="124" x="4" y="87.9575">Runner Network</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="96" x="4" y="103.0903">Environment</text><rect fill="#FFA500" height="844.4375" style="stroke:#000000;stroke-width:0.5;" width="264" x="261" y="75.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="119" x="309.5" y="87.9575">GitLab Instance</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="149" x="309.5" y="103.0903">or GitLab.com SaaS</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="167" x="309.5" y="118.2231">Network Environment</text><rect fill="#ADD8E6" height="844.4375" style="stroke:#000000;stroke-width:0.5;" width="173" x="665.5" y="75.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="87" x="668.5" y="87.9575">Kubernetes</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="167" x="668.5" y="103.0903">Network Environment</text><rect height="662.8516" style="stroke:#000000;stroke-width:1.5;fill:none;" width="804" x="13.5" y="189.8828"/><rect height="149.9297" style="stroke:#000000;stroke-width:1.5;fill:none;" width="355.5" x="23.5" y="214.0156"/><rect height="209.3281" style="stroke:#000000;stroke-width:1.5;fill:none;" width="552.5" x="255" y="377.9453"/><rect height="244.4609" style="stroke:#000000;stroke-width:1.5;fill:none;" width="784" x="23.5" y="601.2734"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="65.5" x2="65.5" y1="172.8828" y2="869.7344"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="196" x2="196" y1="172.8828" y2="869.7344"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="317" x2="317" y1="172.8828" y2="869.7344"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="471" x2="471" y1="172.8828" y2="869.7344"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="590" x2="590" y1="172.8828" y2="869.7344"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="751.5" x2="751.5" y1="172.8828" y2="869.7344"/><rect fill="#008000" height="30.2969" rx="2.5" ry="2.5" style="stroke:#FFFFFF;stroke-width:0.5;" width="65" x="33.5" y="141.5859"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="40.5" y="161.5811">Runner</text><rect fill="#008000" height="30.2969" rx="2.5" ry="2.5" style="stroke:#FFFFFF;stroke-width:0.5;" width="65" x="33.5" y="868.7344"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="40.5" y="888.7295">Runner</text><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#FFFFFF;stroke-width:0.5;" width="118" x="137" y="125.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="150" y="145.2842">Any Network</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104" x="144" y="161.5811">(Incl. Internet)</text><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#FFFFFF;stroke-width:0.5;" width="118" x="137" y="868.7344"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="150" y="888.7295">Any Network</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104" x="144" y="905.0264">(Incl. Internet)</text><rect fill="#FF4500" height="46.5938" rx="2.5" ry="2.5" style="stroke:#FFFFFF;stroke-width:0.5;" width="104" x="265" y="125.2891"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="293" y="145.2842">GitLab</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="272" y="161.5811">Rails Service</text><rect fill="#FF4500" height="46.5938" rx="2.5" ry="2.5" style="stroke:#FFFFFF;stroke-width:0.5;" width="104" x="265" y="868.7344"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="293" y="888.7295">GitLab</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="272" y="905.0264">Rails Service</text><rect fill="#FF4500" height="46.5938" rx="2.5" ry="2.5" style="stroke:#FFFFFF;stroke-width:0.5;" width="100" x="421" y="125.2891"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="447" y="145.2842">GitLab</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="428" y="161.5811">KAS Service</text><rect fill="#FF4500" height="46.5938" rx="2.5" ry="2.5" style="stroke:#FFFFFF;stroke-width:0.5;" width="100" x="421" y="868.7344"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="447" y="888.7295">GitLab</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="428" y="905.0264">KAS Service</text><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#FFFFFF;stroke-width:0.5;" width="118" x="531" y="125.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100" x="540" y="145.2842">Any Network2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104" x="538" y="161.5811">(Incl. Internet)</text><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#FFFFFF;stroke-width:0.5;" width="118" x="531" y="868.7344"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100" x="540" y="888.7295">Any Network2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104" x="538" y="905.0264">(Incl. Internet)</text><rect fill="#0000FF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#FFFFFF;stroke-width:0.5;" width="91" x="706.5" y="125.2891"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="713.5" y="145.2842">GitLab K8s</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="730" y="161.5811">Agent</text><rect fill="#0000FF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#FFFFFF;stroke-width:0.5;" width="91" x="706.5" y="868.7344"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="713.5" y="888.7295">GitLab K8s</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="730" y="905.0264">Agent</text><path d="M13.5,189.8828 L354.5,189.8828 L354.5,197.0156 L344.5,207.0156 L13.5,207.0156 L13.5,189.8828 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="662.8516" style="stroke:#000000;stroke-width:1.5;" width="804" x="13.5" y="189.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="296" x="28.5" y="202.9497">GitLab Secure CI / CD Control Channels</text><path d="M23.5,214.0156 L357.5,214.0156 L357.5,221.1484 L347.5,231.1484 L23.5,231.1484 L23.5,214.0156 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="149.9297" style="stroke:#000000;stroke-width:1.5;" width="355.5" x="23.5" y="214.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="289" x="38.5" y="227.0825">Standard Runner Channel for All CI CD</text><polygon fill="#181818" points="305,263.4141,315,267.4141,305,267.4141" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="66" x2="316" y1="267.4141" y2="267.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="73" y="247.2153">(R1) Runner Initiates SSL</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="73" y="262.3481">Tunnel to 443 [Network]</text><polygon fill="#181818" points="305,312.6797,315,312.6797,305,316.6797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="66" x2="316" y1="311.6797" y2="311.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="73" y="291.481">(R2) Registered Runner</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="73" y="306.6138">Token [Auth]</text><ellipse cx="65.5" cy="355.1953" fill="none" rx="4" ry="4" style="stroke:#181818;stroke-width:1.5;"/><polygon fill="#181818" points="82.5,351.9453,72.5,355.9453,82.5,359.9453,78.5,355.9453" style="stroke:#181818;stroke-width:1.0;"/><ellipse cx="316.5" cy="355.1953" fill="none" rx="4" ry="4" style="stroke:#181818;stroke-width:1.5;"/><line style="stroke:#181818;stroke-width:1.0;" x1="80.5" x2="312" y1="355.9453" y2="355.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="83" y="335.7466">(R3) Runner Job (via Runner</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="83" y="350.8794">Polling) [Control]</text><path d="M255,377.9453 L725,377.9453 L725,385.0781 L715,395.0781 L255,395.0781 L255,377.9453 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="209.3281" style="stroke:#000000;stroke-width:1.5;" width="552.5" x="255" y="377.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="425" x="270" y="391.0122">GitLab Agent Channel (For Runner Push and GitOps Pull)</text><polygon fill="#181818" points="482,442.4766,472,446.4766,482,446.4766" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="471" x2="751" y1="446.4766" y2="446.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="488" y="411.145">(K1) Initiates SSL Tunnel</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="488" y="426.2778">to 443 on KAS dedicated</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="488" y="441.4106">subdomain [Network]</text><polygon fill="#181818" points="482,491.7422,472,491.7422,482,495.7422" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="471" x2="751" y1="490.7422" y2="490.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="488" y="470.5435">(K2) Registered K8s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="488" y="485.6763">Agent Token [Auth]</text><polygon fill="#181818" points="328,536.0078,318,536.0078,328,540.0078" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="317" x2="470" y1="535.0078" y2="535.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="334" y="514.8091">(K3) Registered K8s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="334" y="529.9419">Agent Token [Auth]</text><ellipse cx="470.5" cy="578.5234" fill="none" rx="4" ry="4" style="stroke:#181818;stroke-width:1.5;"/><ellipse cx="751.5" cy="578.5234" fill="none" rx="4" ry="4" style="stroke:#181818;stroke-width:1.5;"/><polygon fill="#181818" points="734.5,575.2734,744.5,579.2734,734.5,583.2734,738.5,579.2734" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="475" x2="740.5" y1="579.2734" y2="579.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="478" y="559.0747">(G1) GitOps Pull Deployment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="478" y="574.2075">(Manifest Polling) [Control]</text><path d="M23.5,601.2734 L427.5,601.2734 L427.5,608.4063 L417.5,618.4063 L23.5,618.4063 L23.5,601.2734 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="244.4609" style="stroke:#000000;stroke-width:1.5;" width="784" x="23.5" y="601.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="359" x="38.5" y="614.3403">Secure Runner CD Push Tunnel to GitLab Agent</text><path d="M476,623.4063 L476,663.4063 L726,663.4063 L726,633.4063 L716,623.4063 L476,623.4063 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M716,623.4063 L716,633.4063 L726,633.4063 L716,623.4063 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="482" y="640.4731">This Control Flow Uses The R and K</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="482" y="655.606">Flows Of The Channels Above.</text><ellipse cx="65.5" cy="704.1875" fill="none" rx="4" ry="4" style="stroke:#181818;stroke-width:1.5;"/><polygon fill="#181818" points="82.5,700.9375,72.5,704.9375,82.5,708.9375,78.5,704.9375" style="stroke:#181818;stroke-width:1.0;"/><ellipse cx="316.5" cy="704.1875" fill="none" rx="4" ry="4" style="stroke:#181818;stroke-width:1.5;"/><line style="stroke:#181818;stroke-width:1.0;" x1="80.5" x2="312" y1="704.9375" y2="704.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="83" y="684.7388">(PushCD1) Runner Job for</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="83" y="699.8716">K8s Agent [Control]</text><polygon fill="#181818" points="459,745.2031,469,749.2031,459,749.2031" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="66" x2="470" y1="749.2031" y2="749.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="261" x="73" y="729.0044">(PushCD2) Initiates SSL Tunnel to 443 on</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234" x="73" y="744.1372">KAS dedicated subdomain [Network]</text><ellipse cx="65.5" cy="792.7188" fill="none" rx="4" ry="4" style="stroke:#181818;stroke-width:1.5;"/><ellipse cx="470.5" cy="792.7188" fill="none" rx="4" ry="4" style="stroke:#181818;stroke-width:1.5;"/><polygon fill="#181818" points="453.5,789.4688,463.5,793.4688,453.5,797.4688,457.5,793.4688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="70" x2="459.5" y1="793.4688" y2="793.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246" x="73" y="773.27">(PushCD3) K8s Control Proxied by KAS</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="73" y="788.4028">Initiate [Control]</text><ellipse cx="470.5" cy="836.9844" fill="none" rx="4" ry="4" style="stroke:#181818;stroke-width:1.5;"/><ellipse cx="751.5" cy="836.9844" fill="none" rx="4" ry="4" style="stroke:#181818;stroke-width:1.5;"/><polygon fill="#181818" points="734.5,833.7344,744.5,837.7344,734.5,841.7344,738.5,837.7344" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="475" x2="740.5" y1="837.7344" y2="837.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216" x="478" y="817.5356">(PushCD4) K8s Control KAS Polled</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="478" y="832.6685">By Agent [Control]</text><rect height="128.0469" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="794" x="22.25" y="921.3281"/><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="417.75" y="930.6104"> </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="417.75" y="942.251"> </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="576" x="131.25" y="953.8916">Each Network Environment must provided suitable network routing, DNS and firewall configuration to allow</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="560" x="139.25" y="965.5322">the connection initiation and return conversations indicated in the lines marked with "[Network]" boxes.</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="417.75" y="977.1729"> </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="561" x="22.25" y="988.8135">The GitLab Instance, Runners and Kubernetes Agents may all be in the same network environment - the</text><text fill="#888888" font-family="sans-serif" font-size="10" font-weight="bold" lengthAdjust="spacing" textLength="116" x="586.25" y="988.8135">most complex case</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="108" x="705.25" y="988.8135">is depicted because</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="744" x="47.25" y="1000.4541">it would be the norm if using GitLab.com SaaS with self-hosted runners to manage Kubernetes clusters in a variety of other environments.</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="417.75" y="1012.0947"> </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="277" x="280.75" y="1023.7354">All dark orange boxes are part of a GitLab Instance.</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="417.75" y="1035.376"> </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="480" x="179.25" y="1047.0166">Only the GitLab K8s integration is required for a pure GitOps workflow (depicted as "(G)").</text><!--MD5=[5a89483832f7246f9bc3b7c3460ab8d2]
@startuml
skinparam shadowing false
skinparam sequenceBoxBorderColor #black
skinparam noteBorderColor #white
skinparam participantBorderColor #white
skinparam participantBackgroundColor #white

Title "GitLab Kubernetes Agent\n Runner CD Push Configuration\n & GitOps Pull Configuration"
box "Runner Network\nEnvironment" #LightGreen
 participant "<font color=white>Runner" as Runner #Green
end box
note right "Any Network\n(Incl. Internet)"
end note
box "GitLab Instance\nor GitLab.com SaaS\nNetwork Environment" #Orange
  participant "<font color=white>GitLab\nRails Service" as GitLabROR #OrangeRed
  participant "<font color=white>GitLab\nKAS Service" as GitLabKAS #OrangeRed
end box
note right "Any Network2\n(Incl. Internet)"
end note
box "Kubernetes\nNetwork Environment" #LightBlue
 participant "<font color=white>GitLab K8s\n<font color=white>Agent" as KubernetesAgent #Blue
end box

group GitLab Secure CI / CD Control Channels
  group Standard Runner Channel for All CI CD
    Runner -\ GitLabROR: (R1) Runner Initiates SSL \nTunnel to 443 [Network]
    Runner -/ GitLabROR: (R2) Registered Runner \nToken [Auth]
    Runner o<-o GitLabROR: (R3) Runner Job (via Runner \nPolling) [Control]
  end group
  group GitLab Agent Channel (For Runner Push and GitOps Pull)
    KubernetesAgent -\ GitLabKAS: (K1) Initiates SSL Tunnel \nto 443 on KAS dedicated \nsubdomain [Network]
    KubernetesAgent -/ GitLabKAS: (K2) Registered K8s \nAgent Token [Auth]
    GitLabKAS -/ GitLabROR: (K3) Registered K8s \nAgent Token [Auth]
    GitLabKAS o->o KubernetesAgent: (G1) GitOps Pull Deployment \n(Manifest Polling) [Control]
  end group

  group Secure Runner CD Push Tunnel to GitLab Agent
    note right of GitLabKAS: This Control Flow Uses The R and K \nFlows Of The Channels Above.
    GitLabROR o->o Runner: (PushCD1) Runner Job for \nK8s Agent [Control]
    Runner -\ GitLabKAS: (PushCD2) Initiates SSL Tunnel to 443 on \nKAS dedicated subdomain [Network]
    Runner o->o GitLabKAS: (PushCD3) K8s Control Proxied by KAS \nInitiate [Control]
    GitLabKAS o->o KubernetesAgent: (PushCD4) K8s Control KAS Polled \nBy Agent [Control]
  end group
end group

center footer \n\nEach Network Environment must provided suitable network routing, DNS and firewall configuration to allow\nthe connection initiation and return conversations indicated in the lines marked with "[Network]" boxes.\n\nThe GitLab Instance, Runners and Kubernetes Agents may all be in the same network environment - the **most complex case** is depicted because \nit would be the norm if using GitLab.com SaaS with self-hosted runners to manage Kubernetes clusters in a variety of other environments.\n\nAll dark orange boxes are part of a GitLab Instance.\n\nOnly the GitLab K8s integration is required for a pure GitOps workflow (depicted as "(G)").
@enduml

PlantUML version 1.2022.6beta5(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>