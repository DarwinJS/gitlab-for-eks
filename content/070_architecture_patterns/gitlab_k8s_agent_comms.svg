<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1100px" preserveAspectRatio="none" style="width:993px;height:1100px;background:#FFFFFF;" version="1.1" viewBox="0 0 993 1100" width="993px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="58.8906" id="_title" style="stroke:none;stroke-width:1.0;" width="259" x="363" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="203" x="391" y="27.9951">GitLab Kubernetes Agent</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="244" x="373" y="44.292">Runner CD Push Configuration</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="225" x="382.5" y="60.5889">&amp; GitOps Pull Configuration</text><rect fill="#90EE90" height="829.3047" style="stroke:#000000;stroke-width:0.5;" width="118" x="107.25" y="75.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="110.25" y="87.9575">Any Runner or</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="90" x="110.25" y="103.0903">GitLab SaaS</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="110.25" y="118.2231">Runners</text><rect fill="#FFA500" height="829.3047" style="stroke:#000000;stroke-width:0.5;" width="259" x="355.25" y="75.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="151" x="409.25" y="87.9575">Any GitLab Instance</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="149" x="409.25" y="103.0903">or GitLab.com SaaS</text><rect fill="#ADD8E6" height="829.3047" style="stroke:#000000;stroke-width:0.5;" width="125" x="744.25" y="75.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="119" x="747.25" y="87.9575">Any Kubernetes</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="55" x="747.25" y="103.0903">Cluster</text><rect fill="none" height="662.8516" style="stroke:#000000;stroke-width:1.5;" width="758.5" x="113.75" y="174.75"/><rect fill="none" height="149.9297" style="stroke:#000000;stroke-width:1.5;" width="349.5" x="123.75" y="198.8828"/><rect fill="none" height="209.3281" style="stroke:#000000;stroke-width:1.5;" width="513" x="349.25" y="362.8125"/><rect fill="none" height="244.4609" style="stroke:#000000;stroke-width:1.5;" width="738.5" x="123.75" y="586.1406"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="165.75" x2="165.75" y1="157.75" y2="854.6016"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="290.25" x2="290.25" y1="157.75" y2="854.6016"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="411.25" x2="411.25" y1="157.75" y2="854.6016"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="560.25" x2="560.25" y1="157.75" y2="854.6016"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="679.25" x2="679.25" y1="157.75" y2="854.6016"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="806.25" x2="806.25" y1="157.75" y2="854.6016"/><rect fill="#008000" height="30.2969" rx="2.5" ry="2.5" style="stroke:#FFFFFF;stroke-width:0.5;" width="65" x="133.75" y="126.4531"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="140.75" y="146.4482">Runner</text><rect fill="#008000" height="30.2969" rx="2.5" ry="2.5" style="stroke:#FFFFFF;stroke-width:0.5;" width="65" x="133.75" y="853.6016"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="140.75" y="873.5967">Runner</text><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#FFFFFF;stroke-width:0.5;" width="118" x="231.25" y="110.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="244.25" y="130.1514">Any Network</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104" x="238.25" y="146.4482">(Incl. Internet)</text><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#FFFFFF;stroke-width:0.5;" width="118" x="231.25" y="853.6016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="244.25" y="873.5967">Any Network</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104" x="238.25" y="889.8936">(Incl. Internet)</text><rect fill="#FF4500" height="46.5938" rx="2.5" ry="2.5" style="stroke:#FFFFFF;stroke-width:0.5;" width="104" x="359.25" y="110.1563"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="387.25" y="130.1514">GitLab</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="366.25" y="146.4482">Rails Service</text><rect fill="#FF4500" height="46.5938" rx="2.5" ry="2.5" style="stroke:#FFFFFF;stroke-width:0.5;" width="104" x="359.25" y="853.6016"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="387.25" y="873.5967">GitLab</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="366.25" y="889.8936">Rails Service</text><rect fill="#FF4500" height="46.5938" rx="2.5" ry="2.5" style="stroke:#FFFFFF;stroke-width:0.5;" width="100" x="510.25" y="110.1563"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="536.25" y="130.1514">GitLab</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="517.25" y="146.4482">KAS Service</text><rect fill="#FF4500" height="46.5938" rx="2.5" ry="2.5" style="stroke:#FFFFFF;stroke-width:0.5;" width="100" x="510.25" y="853.6016"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="536.25" y="873.5967">GitLab</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="517.25" y="889.8936">KAS Service</text><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#FFFFFF;stroke-width:0.5;" width="118" x="620.25" y="110.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100" x="629.25" y="130.1514">Any Network2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104" x="627.25" y="146.4482">(Incl. Internet)</text><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#FFFFFF;stroke-width:0.5;" width="118" x="620.25" y="853.6016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100" x="629.25" y="873.5967">Any Network2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104" x="627.25" y="889.8936">(Incl. Internet)</text><rect fill="#0000FF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#FFFFFF;stroke-width:0.5;" width="91" x="761.25" y="110.1563"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="768.25" y="130.1514">GitLab K8s</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="784.75" y="146.4482">Agent</text><rect fill="#0000FF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#FFFFFF;stroke-width:0.5;" width="91" x="761.25" y="853.6016"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="768.25" y="873.5967">GitLab K8s</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="784.75" y="889.8936">Agent</text><path d="M113.75,174.75 L454.75,174.75 L454.75,181.8828 L444.75,191.8828 L113.75,191.8828 L113.75,174.75 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="662.8516" style="stroke:#000000;stroke-width:1.5;" width="758.5" x="113.75" y="174.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="296" x="128.75" y="187.8169">GitLab Secure CI / CD Control Channels</text><path d="M123.75,198.8828 L457.75,198.8828 L457.75,206.0156 L447.75,216.0156 L123.75,216.0156 L123.75,198.8828 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="149.9297" style="stroke:#000000;stroke-width:1.5;" width="349.5" x="123.75" y="198.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="289" x="138.75" y="211.9497">Standard Runner Channel for All CI CD</text><polygon fill="#181818" points="399.25,248.2813,409.25,252.2813,399.25,252.2813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="166.25" x2="410.25" y1="252.2813" y2="252.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="173.25" y="232.0825">(i) Runner Initiates SSL</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="173.25" y="247.2153">Tunnel to 443 [Network]</text><polygon fill="#181818" points="399.25,297.5469,409.25,297.5469,399.25,301.5469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="166.25" x2="410.25" y1="296.5469" y2="296.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="173.25" y="276.3481">(ii) Registered Runner</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="173.25" y="291.481">Token [Auth]</text><ellipse cx="165.75" cy="340.0625" fill="none" rx="4" ry="4" style="stroke:#181818;stroke-width:1.5;"/><polygon fill="#181818" points="182.75,336.8125,172.75,340.8125,182.75,344.8125,178.75,340.8125" style="stroke:#181818;stroke-width:1.0;"/><ellipse cx="410.75" cy="340.0625" fill="none" rx="4" ry="4" style="stroke:#181818;stroke-width:1.5;"/><line style="stroke:#181818;stroke-width:1.0;" x1="180.75" x2="406.25" y1="340.8125" y2="340.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="183.25" y="320.6138">(iii) Runner Job (via Runner</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="183.25" y="335.7466">Polling) [Control]</text><path d="M349.25,362.8125 L819.25,362.8125 L819.25,369.9453 L809.25,379.9453 L349.25,379.9453 L349.25,362.8125 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="209.3281" style="stroke:#000000;stroke-width:1.5;" width="513" x="349.25" y="362.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="425" x="364.25" y="375.8794">GitLab Agent Channel (For Runner Push and GitOps Pull)</text><polygon fill="#181818" points="571.25,427.3438,561.25,431.3438,571.25,431.3438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="560.25" x2="805.75" y1="431.3438" y2="431.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="577.25" y="396.0122">(1) Initiates WSS (SSL) Tunnel</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="577.25" y="411.145">to KAS dedicated</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="577.25" y="426.2778">subdomain [Network]</text><polygon fill="#181818" points="571.25,476.6094,561.25,476.6094,571.25,480.6094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="560.25" x2="805.75" y1="475.6094" y2="475.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="577.25" y="455.4106">(2) Registered K8s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="577.25" y="470.5435">Agent Token [Auth]</text><polygon fill="#181818" points="422.25,520.875,412.25,520.875,422.25,524.875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="411.25" x2="559.25" y1="519.875" y2="519.875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="428.25" y="499.6763">(3) Registered K8s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="428.25" y="514.8091">Agent Token [Auth]</text><ellipse cx="559.75" cy="563.3906" fill="none" rx="4" ry="4" style="stroke:#181818;stroke-width:1.5;"/><ellipse cx="806.25" cy="563.3906" fill="none" rx="4" ry="4" style="stroke:#181818;stroke-width:1.5;"/><polygon fill="#181818" points="789.25,560.1406,799.25,564.1406,789.25,568.1406,793.25,564.1406" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="564.25" x2="795.25" y1="564.1406" y2="564.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174" x="567.25" y="543.9419">(4) GitOps Pull Deployment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="567.25" y="559.0747">(Manifest Polling) [Control]</text><path d="M123.75,586.1406 L527.75,586.1406 L527.75,593.2734 L517.75,603.2734 L123.75,603.2734 L123.75,586.1406 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="244.4609" style="stroke:#000000;stroke-width:1.5;" width="738.5" x="123.75" y="586.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="359" x="138.75" y="599.2075">Secure Runner CD Push Tunnel to GitLab Agent</text><path d="M564.75,608.2734 L564.75,648.2734 L823.75,648.2734 L823.75,618.2734 L813.75,608.2734 L564.75,608.2734 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M813.75,608.2734 L813.75,618.2734 L823.75,618.2734 L813.75,608.2734 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="570.75" y="625.3403">This Control Flow Uses The</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="238" x="570.75" y="640.4731">Connections Of The Channels Above.</text><ellipse cx="165.75" cy="689.0547" fill="none" rx="4" ry="4" style="stroke:#181818;stroke-width:1.5;"/><polygon fill="#181818" points="182.75,685.8047,172.75,689.8047,182.75,693.8047,178.75,689.8047" style="stroke:#181818;stroke-width:1.0;"/><ellipse cx="410.75" cy="689.0547" fill="none" rx="4" ry="4" style="stroke:#181818;stroke-width:1.5;"/><line style="stroke:#181818;stroke-width:1.0;" x1="180.75" x2="406.25" y1="689.8047" y2="689.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="183.25" y="669.606">(A) Runner Job with</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="183.25" y="684.7388">K8s CMDs [Control]</text><polygon fill="#181818" points="548.25,730.0703,558.25,734.0703,548.25,734.0703" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="166.25" x2="559.25" y1="734.0703" y2="734.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="173.25" y="713.8716">(B) Initiates WSS (SSL) Tunnel to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234" x="173.25" y="729.0044">KAS dedicated subdomain [Network]</text><ellipse cx="165.75" cy="777.5859" fill="none" rx="4" ry="4" style="stroke:#181818;stroke-width:1.5;"/><ellipse cx="559.75" cy="777.5859" fill="none" rx="4" ry="4" style="stroke:#181818;stroke-width:1.5;"/><polygon fill="#181818" points="542.75,774.3359,552.75,778.3359,542.75,782.3359,546.75,778.3359" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="170.25" x2="548.75" y1="778.3359" y2="778.3359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="173.25" y="758.1372">(C) K8s Control Proxied by KAS</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="173.25" y="773.27">with K8s CMDs [Control]</text><ellipse cx="559.75" cy="821.8516" fill="none" rx="4" ry="4" style="stroke:#181818;stroke-width:1.5;"/><ellipse cx="806.25" cy="821.8516" fill="none" rx="4" ry="4" style="stroke:#181818;stroke-width:1.5;"/><polygon fill="#181818" points="789.25,818.6016,799.25,822.6016,789.25,826.6016,793.25,822.6016" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="564.25" x2="795.25" y1="822.6016" y2="822.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="567.25" y="802.4028">(D) Push K8s Control</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="567.25" y="817.5356">with K8s CMDs [Control]</text><rect fill="none" height="186.25" id="_title" style="stroke:none;stroke-width:1.0;" width="985" x="0" y="906.1953"/><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="491" y="915.4775"> </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="576" x="204.5" y="927.1182">Each Network Environment must provided suitable network routing, DNS and firewall configuration to allow</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="477" x="254" y="938.7588">the connection initiation and return conversations indicated in the network connections.</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="491" y="950.3994"> </text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="634" x="60.5" y="962.04">All GitLab Components (Instance, Runners and Kubernetes Agents) may all be in the same network environment - the</text><text fill="#888888" font-family="sans-serif" font-size="10" font-weight="bold" lengthAdjust="spacing" textLength="116" x="697.5" y="962.04">most complex case</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="108" x="816.5" y="962.04">is depicted because</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="754" x="115.5" y="973.6807">it would be the default if using GitLab.com SaaS with self-hosted runners to manage Kubernetes clusters in a variety of other environments.</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="491" y="985.3213"> </text><text fill="#888888" font-family="sans-serif" font-size="10" font-weight="bold" lengthAdjust="spacing" textLength="78" x="0" y="996.9619">IMPORTANT:</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="904" x="81" y="996.9619">Arrows indicate connection initiation direction - in the case of network connections the design allows embedding of Runners and GitLab Agents in secure environments.</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="491" y="1008.6025"> </text><text fill="#888888" font-family="sans-serif" font-size="10" font-weight="bold" lengthAdjust="spacing" textLength="497" x="106" y="1020.2432">Scenario 1: For a standard Push CD Runner configuration (for K8s and non-K8s)</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="270" x="609" y="1020.2432">- only sequenced series "i. through iii." is required.</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="491" y="1031.8838"> </text><text fill="#888888" font-family="sans-serif" font-size="10" font-weight="bold" lengthAdjust="spacing" textLength="286" x="131.5" y="1043.5244">Scenario 2: For a GitOps Pull CD configuration</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="433" x="420.5" y="1043.5244">- only the GitLab Agent integration is required - sequenced series "1. through 3."</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="491" y="1055.165"> </text><text fill="#888888" font-family="sans-serif" font-size="10" font-weight="bold" lengthAdjust="spacing" textLength="325" x="10" y="1066.8057">Scenario 3: For a Kubernetes Push CD configuration</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="637" x="338" y="1066.8057">the prior two sequenced series are required along with the configuration depicted as sequenced series 'A. Through B."</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="3" x="491" y="1078.4463"> </text><text fill="#888888" font-family="sans-serif" font-size="10" font-weight="bold" lengthAdjust="spacing" textLength="257" x="235.5" y="1090.0869">The complete Push CD K8s Command flow</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="254" x="495.5" y="1090.0869">is depicted as sequenced series "A. through D."</text><!--MD5=[b6edae5e5dbb2e4b37ad07004bfe16ef]
@startuml
skinparam shadowing false
skinparam sequenceBoxBorderColor #black
skinparam noteBorderColor #white
skinparam participantBorderColor #white
skinparam participantBackgroundColor #white

Title "GitLab Kubernetes Agent\n Runner CD Push Configuration\n & GitOps Pull Configuration"
box "Any Runner or \nGitLab SaaS \nRunners" #LightGreen
 participant "<font color=white>Runner" as Runner #Green
end box
note right "Any Network\n(Incl. Internet)"
end note
box "Any GitLab Instance\nor GitLab.com SaaS" #Orange
  participant "<font color=white>GitLab\nRails Service" as GitLabROR #OrangeRed
  participant "<font color=white>GitLab\nKAS Service" as GitLabKAS #OrangeRed
end box
note right "Any Network2\n(Incl. Internet)"
end note
box "Any Kubernetes\nCluster" #LightBlue
 participant "<font color=white>GitLab K8s\n<font color=white>Agent" as KubernetesAgent #Blue
end box

group GitLab Secure CI / CD Control Channels
  group Standard Runner Channel for All CI CD
    Runner -\ GitLabROR: (i) Runner Initiates SSL \nTunnel to 443 [Network]
    Runner -/ GitLabROR: (ii) Registered Runner \nToken [Auth]
    Runner o<-o GitLabROR: (iii) Runner Job (via Runner \nPolling) [Control]
  end group
  group GitLab Agent Channel (For Runner Push and GitOps Pull)
    KubernetesAgent -\ GitLabKAS: (1) Initiates WSS (SSL) Tunnel \nto KAS dedicated \nsubdomain [Network]
    KubernetesAgent -/ GitLabKAS: (2) Registered K8s \nAgent Token [Auth]
    GitLabKAS -/ GitLabROR: (3) Registered K8s \nAgent Token [Auth]
    GitLabKAS o->o KubernetesAgent: (4) GitOps Pull Deployment \n(Manifest Polling) [Control]
  end group

  group Secure Runner CD Push Tunnel to GitLab Agent
    note right of GitLabKAS: This Control Flow Uses The \nConnections Of The Channels Above.
    GitLabROR o->o Runner: (A) Runner Job with \nK8s CMDs [Control]
    Runner -\ GitLabKAS: (B) Initiates WSS (SSL) Tunnel to \nKAS dedicated subdomain [Network]
    Runner o->o GitLabKAS: (C) K8s Control Proxied by KAS \nwith K8s CMDs [Control]
    GitLabKAS o->o KubernetesAgent: (D) Push K8s Control \nwith K8s CMDs [Control]
  end group
end group

footer

Each Network Environment must provided suitable network routing, DNS and firewall configuration to allow
the connection initiation and return conversations indicated in the network connections.

All GitLab Components (Instance, Runners and Kubernetes Agents) may all be in the same network environment - the **most complex case** is depicted because 
it would be the default if using GitLab.com SaaS with self-hosted runners to manage Kubernetes clusters in a variety of other environments.

<b>IMPORTANT:</b> Arrows indicate connection initiation direction - in the case of network connections the design allows embedding of Runners and GitLab Agents in secure environments.

<b>Scenario 1: For a standard Push CD Runner configuration (for K8s and non-K8s) </b> - only sequenced series "i. through iii." is required.

<b>Scenario 2: For a GitOps Pull CD configuration</b> - only the GitLab Agent integration is required - sequenced series "1. through 3."

<b>Scenario 3: For a Kubernetes Push CD configuration</b> the prior two sequenced series are required along with the configuration depicted as sequenced series 'A. Through B."

<b>The complete Push CD K8s Command flow</b> is depicted as sequenced series "A. through D."
end footer
@enduml

PlantUML version 1.2022.8beta8(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>